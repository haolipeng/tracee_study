# Tracee æºä»£ç å­¦ä¹ æŒ‡å— - ç¬¬ä¸€é˜¶æ®µï¼šæ¶æ„æ¦‚è§ˆ

> **å­¦ä¹ ç›®æ ‡**ï¼šç†è§£ Tracee çš„æ•´ä½“æ¶æ„ã€æ ¸å¿ƒç»„ä»¶å’Œå¯åŠ¨æµç¨‹
> **é¢„è®¡æ—¶é—´**ï¼š2-3 å¤©
> **å‰ç½®çŸ¥è¯†**ï¼šLinux ç³»ç»Ÿç¼–ç¨‹åŸºç¡€ã€eBPF åŸºæœ¬æ¦‚å¿µã€Go è¯­è¨€åŸºç¡€

---

## ğŸ“‹ ç›®å½•

1. [Tracee æ˜¯ä»€ä¹ˆ](#1-tracee-æ˜¯ä»€ä¹ˆ)
2. [æ•´ä½“æ¶æ„è®¾è®¡](#2-æ•´ä½“æ¶æ„è®¾è®¡)
3. [é¡¹ç›®ç›®å½•ç»“æ„](#3-é¡¹ç›®ç›®å½•ç»“æ„)
4. [æ ¸å¿ƒå¯åŠ¨æµç¨‹](#4-æ ¸å¿ƒå¯åŠ¨æµç¨‹)
5. [Tracee æ ¸å¿ƒç»“æ„ä½“](#5-tracee-æ ¸å¿ƒç»“æ„ä½“)
6. [å®è·µç»ƒä¹ ](#6-å®è·µç»ƒä¹ )
7. [ä¸‹ä¸€æ­¥å­¦ä¹ ](#7-ä¸‹ä¸€æ­¥å­¦ä¹ )

---

## 1. Tracee æ˜¯ä»€ä¹ˆ

### 1.1 æ ¸å¿ƒå®šä½

Tracee æ˜¯ä¸€ä¸ª**è¿è¡Œæ—¶å®‰å…¨å’Œå¯è§‚æµ‹æ€§å·¥å…·**ï¼Œä½¿ç”¨ eBPF æŠ€æœ¯ç›‘æ§ Linux ç³»ç»Ÿè¡Œä¸ºï¼š

- ğŸ” **ç³»ç»Ÿç›‘æ§**ï¼šè·Ÿè¸ªç³»ç»Ÿè°ƒç”¨ã€è¿›ç¨‹æ‰§è¡Œã€æ–‡ä»¶æ“ä½œã€ç½‘ç»œæ´»åŠ¨
- ğŸ›¡ï¸ **å®‰å…¨æ£€æµ‹**ï¼šè¯†åˆ«å¯ç–‘è¡Œä¸ºæ¨¡å¼å’Œæ½œåœ¨å®‰å…¨å¨èƒ
- ğŸ“Š **å¯è§‚æµ‹æ€§**ï¼šæä¾›åº”ç”¨å’Œç³»ç»Ÿè¡Œä¸ºçš„æ·±åº¦æ´å¯Ÿ
- ğŸš¨ **å®æ—¶å‘Šè­¦**ï¼šç”Ÿæˆäº‹ä»¶ç”¨äºå³æ—¶å¨èƒæ£€æµ‹å’Œå“åº”

### 1.2 å…³é”®ç‰¹æ€§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ ¸å¿ƒè®¾è®¡ç†å¿µï¼šEverything is an Eventï¼ˆä¸€åˆ‡çš†äº‹ä»¶ï¼‰      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚  âœ“ 400+ å†…ç½®äº‹ä»¶ï¼ˆç³»ç»Ÿè°ƒç”¨ã€ç½‘ç»œã€å®‰å…¨äº‹ä»¶ï¼‰             â”‚
â”‚  âœ“ é›¶ä»£ç ä¿®æ”¹ï¼ˆæ— éœ€ä¿®æ”¹ç›®æ ‡åº”ç”¨ï¼‰                       â”‚
â”‚  âœ“ ä½å¼€é”€ï¼ˆé«˜æ•ˆçš„ eBPF ç¨‹åºï¼‰                          â”‚
â”‚  âœ“ å®¹å™¨æ„ŸçŸ¥ï¼ˆåŸç”Ÿæ”¯æŒ Docker/K8sï¼‰                     â”‚
â”‚  âœ“ çµæ´»ç­–ç•¥ï¼ˆè‡ªå®šä¹‰ç›‘æ§è§„åˆ™ï¼‰                          â”‚
â”‚  âœ“ å–è¯èƒ½åŠ›ï¼ˆç½‘ç»œæµé‡æ•è·ã€äºŒè¿›åˆ¶æ”¶é›†ã€å†…å­˜è½¬å‚¨ï¼‰        â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 æŠ€æœ¯æ ˆ

| å±‚æ¬¡ | æŠ€æœ¯ | ç”¨é€” |
|------|------|------|
| **å†…æ ¸ä¾§** | eBPF (C) | äº‹ä»¶æ•è·å’Œè¿‡æ»¤ |
| **ç”¨æˆ·ä¾§** | Go 1.24+ | äº‹ä»¶å¤„ç†å’Œä¸šåŠ¡é€»è¾‘ |
| **é€šä¿¡** | Perf Buffer | å†…æ ¸â†’ç”¨æˆ·ç©ºé—´æ•°æ®ä¼ è¾“ |
| **ä¾èµ–** | libbpfgo | eBPF ç¨‹åºåŠ è½½å’Œç®¡ç† |
| **å®¹å™¨** | containerd/Docker API | å®¹å™¨å…ƒæ•°æ®è·å– |

---

## 2. æ•´ä½“æ¶æ„è®¾è®¡

### 2.1 ç³»ç»Ÿåˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ç”¨æˆ·ç©ºé—´ (User Space)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  CLI å…¥å£     â”‚â”€â”€â”€â”€â”€â–¶â”‚  Runner ä¸»æ§  â”‚â”€â”€â”€â”€â”€â–¶â”‚  è¾“å‡ºæ¨¡å—     â”‚ â”‚
â”‚  â”‚ cmd/tracee   â”‚      â”‚ cmd/tracee.go â”‚      â”‚  (Printer)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                â”‚                                 â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                        â”‚  Tracee æ ¸å¿ƒ    â”‚                       â”‚
â”‚                        â”‚ pkg/ebpf/tracee â”‚                       â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                â”‚                                 â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚         â”‚                      â”‚                      â”‚        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ äº‹ä»¶æµæ°´çº¿   â”‚       â”‚  ç­–ç•¥å¼•æ“   â”‚      â”‚  ç­¾åå¼•æ“     â”‚ â”‚
â”‚   â”‚ Pipeline    â”‚       â”‚  Policy     â”‚      â”‚  Signatures   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         â”‚              å†…æ ¸ç©ºé—´ (Kernel Space - eBPF)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   â”‚  sys_enter    â”‚   â”‚   LSM Hooks   â”‚   â”‚   kprobes       â”‚â”‚
â”‚   â”‚  tracepoint   â”‚   â”‚  (Security)   â”‚   â”‚   (VFS/Net)     â”‚â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚           â”‚                   â”‚                     â”‚         â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                               â–¼                                â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                      â”‚  Perf Buffer    â”‚                       â”‚
â”‚                      â”‚  (Event Queue)  â”‚                       â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ•°æ®æµå‘

```
å†…æ ¸äº‹ä»¶æ•è· â†’ Perf Buffer â†’ è§£ç  â†’ æ’åº â†’ å¤„ç† â†’ ä¸°å¯Œ â†’ æ´¾ç”Ÿ â†’ æ£€æµ‹ â†’ è¾“å‡º
     â†“              â†“          â†“      â†“      â†“      â†“      â†“      â†“      â†“
   eBPF C        Channel    Decode  Sort  Process Enrich Derive Engine  Sink
```

---

## 3. é¡¹ç›®ç›®å½•ç»“æ„

### 3.1 æ ¸å¿ƒç›®å½•

```
tracee/
â”œâ”€â”€ cmd/                          # å‘½ä»¤è¡Œå·¥å…·
â”‚   â”œâ”€â”€ tracee/                   # ä¸»ç¨‹åºå…¥å£
â”‚   â”‚   â”œâ”€â”€ main.go              # ç¨‹åºå…¥å£ç‚¹
â”‚   â”‚   â””â”€â”€ cmd/
â”‚   â”‚       â””â”€â”€ root.go          # Cobra å‘½ä»¤å®šä¹‰
â”‚   â”œâ”€â”€ tracee-ebpf/             # é—ç•™å‘½ä»¤
â”‚   â”œâ”€â”€ tracee-rules/            # è§„åˆ™å¼•æ“å‘½ä»¤
â”‚   â””â”€â”€ traceectl/               # æ§åˆ¶å·¥å…·
â”‚
â”œâ”€â”€ pkg/                          # æ ¸å¿ƒåŒ…ï¼ˆ262ä¸ª Go æ–‡ä»¶ï¼‰
â”‚   â”œâ”€â”€ ebpf/                    # â˜…â˜…â˜… eBPF æ ¸å¿ƒå¼•æ“
â”‚   â”‚   â”œâ”€â”€ tracee.go            # Tracee ä¸»ç»“æ„ä½“ï¼ˆ2000+è¡Œï¼‰
â”‚   â”‚   â”œâ”€â”€ events_pipeline.go   # äº‹ä»¶å¤„ç†æµæ°´çº¿
â”‚   â”‚   â”œâ”€â”€ initialization/      # åˆå§‹åŒ–é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ probes/              # æ¢é’ˆç®¡ç†
â”‚   â”‚   â””â”€â”€ c/                   # â˜… eBPF C ä»£ç 
â”‚   â”‚       â”œâ”€â”€ tracee.bpf.c     # ä¸» eBPF ç¨‹åºï¼ˆ7566è¡Œï¼‰
â”‚   â”‚       â””â”€â”€ common/          # é€šç”¨ eBPF å¤´æ–‡ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ events/                  # â˜…â˜…â˜… äº‹ä»¶å®šä¹‰ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ core.go              # äº‹ä»¶ ID å’Œæ ¸å¿ƒå®šä¹‰ï¼ˆ14000+è¡Œï¼‰
â”‚   â”‚   â”œâ”€â”€ definition.go        # äº‹ä»¶å…ƒæ•°æ®ç»“æ„
â”‚   â”‚   â”œâ”€â”€ dependencies/        # äº‹ä»¶ä¾èµ–ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ derive/              # æ´¾ç”Ÿäº‹ä»¶
â”‚   â”‚   â””â”€â”€ parse/               # å‚æ•°è§£æ
â”‚   â”‚
â”‚   â”œâ”€â”€ policy/                  # â˜…â˜… ç­–ç•¥å¼•æ“
â”‚   â”‚   â”œâ”€â”€ policy_manager.go    # ç­–ç•¥ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ ebpf.go              # ç­–ç•¥â†’eBPF æ˜ å°„
â”‚   â”‚
â”‚   â”œâ”€â”€ signatures/              # â˜…â˜… å®‰å…¨æ£€æµ‹ç­¾å
â”‚   â”‚   â”œâ”€â”€ engine/              # ç­¾åå¼•æ“
â”‚   â”‚   â””â”€â”€ signature/           # ç­¾åæ¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ filters/                 # è¿‡æ»¤å™¨ç³»ç»Ÿ
â”‚   â”œâ”€â”€ containers/              # å®¹å™¨æ„ŸçŸ¥
â”‚   â”œâ”€â”€ proctree/                # è¿›ç¨‹æ ‘è¿½è¸ª
â”‚   â”œâ”€â”€ dnscache/                # DNS ç¼“å­˜
â”‚   â”œâ”€â”€ bufferdecoder/           # äº‹ä»¶è§£ç 
â”‚   â””â”€â”€ cmd/                     # å‘½ä»¤è¡Œè¾…åŠ©
â”‚
â”œâ”€â”€ types/                        # ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ trace/                   # trace.Event å®šä¹‰
â”‚
â”œâ”€â”€ signatures/                   # ç­¾åå®ç°ç¤ºä¾‹
â”‚   â””â”€â”€ golang/                  # Go è¯­è¨€ç­¾å
â”‚
â””â”€â”€ docs/                         # æ–‡æ¡£
    â”œâ”€â”€ docs/                    # ç”¨æˆ·æ–‡æ¡£
    â””â”€â”€ contributing/            # å¼€å‘è€…æ–‡æ¡£
```

### 3.2 å…³é”®æ–‡ä»¶æ¸…å•

| æ–‡ä»¶è·¯å¾„ | ä»£ç è¡Œæ•° | æ ¸å¿ƒåŠŸèƒ½ |
|---------|---------|---------|
| `pkg/ebpf/c/tracee.bpf.c` | 7566 | eBPF ä¸»ç¨‹åº |
| `pkg/events/core.go` | 14000+ | äº‹ä»¶å®šä¹‰ |
| `pkg/ebpf/tracee.go` | 2000+ | Tracee æ ¸å¿ƒ |
| `pkg/ebpf/events_pipeline.go` | 500+ | äº‹ä»¶æµæ°´çº¿ |
| `pkg/policy/policy_manager.go` | 400+ | ç­–ç•¥ç®¡ç† |
| `pkg/bufferdecoder/decoder.go` | 600+ | äº‹ä»¶è§£ç  |

---

## 4. æ ¸å¿ƒå¯åŠ¨æµç¨‹

### 4.1 å¯åŠ¨æ—¶åºå›¾

```
ç”¨æˆ·æ‰§è¡Œ: sudo ./tracee
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ main.go:11      â”‚  ç¨‹åºå…¥å£
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ cmd.Execute()   â”‚  Cobra å‘½ä»¤æ¡†æ¶
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ root.go:52 - Run()                  â”‚
    â”‚ 1. åˆå§‹åŒ–æ—¥å¿—                        â”‚
    â”‚ 2. è®¾ç½® libbpf å›è°ƒ                  â”‚
    â”‚ 3. GetTraceeRunner() - è§£æé…ç½®      â”‚
    â”‚ 4. åˆ›å»ºä¿¡å·å¤„ç†ä¸Šä¸‹æ–‡                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ tracee.go:27 - Runner.Run()         â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚ â”‚ æ­¥éª¤1: tracee.New(config)       â”‚ â”‚ â† åˆ›å»ºå®ä¾‹
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚ â”‚ æ­¥éª¤2: AddReadyCallback()       â”‚ â”‚ â† æ³¨å†Œå›è°ƒ
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚ â”‚ æ­¥éª¤3: t.Init(ctx)              â”‚ â”‚ â† åˆå§‹åŒ– eBPF
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚ â”‚ æ­¥éª¤4: t.Run(ctx)               â”‚ â”‚ â† è¿è¡Œä¸»å¾ªç¯
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ tracee.Init() - pkg/ebpf/tracee.go â”‚
    â”‚ 1. åŠ è½½ eBPF ç¨‹åºåˆ°å†…æ ¸              â”‚
    â”‚ 2. åˆ›å»º Perf Buffers                â”‚
    â”‚ 3. é™„åŠ æ¢é’ˆï¼ˆkprobe/LSM/tracepointï¼‰ â”‚
    â”‚ 4. åˆå§‹åŒ–å®¹å™¨/è¿›ç¨‹æ ‘/DNSç¼“å­˜          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ tracee.Run() - å¼€å§‹äº‹ä»¶å¤„ç†          â”‚
    â”‚ â†’ handleEvents() æµæ°´çº¿å¯åŠ¨          â”‚
    â”‚ â†’ è®¢é˜…äº‹ä»¶æµå¹¶è¾“å‡º                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å…³é”®ä»£ç è§£æ

#### æ­¥éª¤1: å…¥å£ç‚¹ - [cmd/tracee/main.go:11](cmd/tracee/main.go#L11)

```go
func main() {
    err := cmd.Execute()  // è°ƒç”¨ Cobra å‘½ä»¤
    if err != nil {
        fmt.Fprintf(os.Stderr, "Error: %v\n", err)
        os.Exit(1)
    }
    os.Exit(0)
}
```

#### æ­¥éª¤2: å‘½ä»¤æ‰§è¡Œ - [cmd/tracee/cmd/root.go:52](cmd/tracee/cmd/root.go#L52)

```go
Run: func(cmd *cobra.Command, args []string) {
    // 1. åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ
    logger.Init(logger.NewDefaultLoggingConfig())

    // 2. è®¾ç½® libbpfgo çš„æ—¥å¿—å›è°ƒ
    initialize.SetLibbpfgoCallbacks()

    // 3. åˆ›å»º Runnerï¼ˆè§£ææ‰€æœ‰é…ç½®å’Œæ ‡å¿—ï¼‰
    runner, err := cmdcobra.GetTraceeRunner(cmd, version.GetVersion())
    if err != nil {
        fmt.Fprintf(os.Stderr, "Error: %s\n", err)
        os.Exit(1)
    }

    // 4. åˆ›å»ºå¯å–æ¶ˆçš„ä¸Šä¸‹æ–‡ï¼ˆç›‘å¬ SIGINT/SIGTERMï¼‰
    ctx, stop := signal.NotifyContext(
        context.Background(),
        syscall.SIGINT,
        syscall.SIGTERM,
    )
    defer stop()

    // 5. æ‰§è¡Œä¸»è¿è¡Œé€»è¾‘
    err = runner.Run(ctx)
    if err != nil {
        logger.Fatalw("Tracee runner failed", "error", err)
        os.Exit(1)
    }
}
```

**å…³é”®é…ç½®å‚æ•°**ï¼š

| å‚æ•° | ç®€å†™ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--scope` | `-s` | `[]` | è¿‡æ»¤å·¥ä½œè´Ÿè½½ï¼ˆå¦‚ `uid=0`ã€`container=new`ï¼‰ |
| `--events` | `-e` | `[]` | é€‰æ‹©äº‹ä»¶ï¼ˆå¦‚ `execve`ã€`security_file_open`ï¼‰ |
| `--policy` | `-p` | `[]` | ç­–ç•¥æ–‡ä»¶è·¯å¾„ |
| `--output` | `-o` | `table` | è¾“å‡ºæ ¼å¼ï¼ˆjson/table/webhookï¼‰ |
| `--perf-buffer-size` | `-b` | `1024` | Perf Buffer å¤§å°ï¼ˆé¡µæ•°ï¼‰ |
| `--capture` | `-c` | `[]` | æ•è·ç±»å‹ï¼ˆwrite/exec/networkï¼‰ |

#### æ­¥éª¤3: Runner æ‰§è¡Œ - [pkg/cmd/tracee.go:27](pkg/cmd/tracee.go#L27)

```go
func (r Runner) Run(ctx context.Context) error {
    // â˜…â˜…â˜… æ ¸å¿ƒæ­¥éª¤1: åˆ›å»º Tracee å®ä¾‹ â˜…â˜…â˜…
    t, err := tracee.New(r.TraceeConfig)
    if err != nil {
        return errfmt.Errorf("error creating Tracee: %v", err)
    }

    // â˜…â˜…â˜… æ ¸å¿ƒæ­¥éª¤2: æ·»åŠ å°±ç»ªå›è°ƒ â˜…â˜…â˜…
    // å½“ Tracee å‡†å¤‡å¥½æ¥æ”¶äº‹ä»¶æ—¶è°ƒç”¨
    t.AddReadyCallback(
        func(ctx context.Context) {
            logger.Debugw("Tracee is ready callback")

            // å¯åŠ¨ HTTP æœåŠ¡å™¨ï¼ˆPrometheus metricsï¼‰
            if r.HTTP != nil {
                if r.HTTP.MetricsEndpointEnabled() {
                    t.Stats().RegisterPrometheus()
                }
                go r.HTTP.Start(ctx)
            }

            // å¯åŠ¨ gRPC æœåŠ¡å™¨ï¼ˆAPIï¼‰
            if r.GRPC != nil {
                go r.GRPC.Start(ctx, t, t.Engine())
            }
        },
    )

    // é‡Šæ”¾ BPF å¯¹è±¡å­—èŠ‚ï¼ˆå…è®¸ GC å›æ”¶ï¼‰
    r.TraceeConfig.BPFObjBytes = nil

    // â˜…â˜…â˜… æ ¸å¿ƒæ­¥éª¤3: åˆå§‹åŒ– Tracee â˜…â˜…â˜…
    // åŠ è½½ eBPF ç¨‹åºã€åˆ›å»º mapsã€é™„åŠ æ¢é’ˆ
    err = t.Init(ctx)
    if err != nil {
        return errfmt.Errorf("error initializing Tracee: %v", err)
    }

    // ç®¡ç† PID æ–‡ä»¶
    if err := os.MkdirAll(r.InstallPath, 0755); err != nil {
        return errfmt.Errorf("could not create install path dir: %v", err)
    }
    installPathDir, _ := fileutil.OpenExistingDir(r.InstallPath)
    defer installPathDir.Close()

    writePidFile(installPathDir)
    defer removePidFile(installPathDir)

    // â˜…â˜…â˜… æ ¸å¿ƒæ­¥éª¤4: è¿è¡Œ Tracee â˜…â˜…â˜…
    if r.Printer.Active() {
        // è®¢é˜…äº‹ä»¶æµå¹¶æ‰“å°
        return r.runWithPrinter(ctx, t)
    }

    // ä»…è¿è¡Œä¸æ‰“å°ï¼ˆé€šè¿‡ gRPC è·å–äº‹ä»¶ï¼‰
    return t.Run(ctx)
}
```

#### æ­¥éª¤4: äº‹ä»¶è®¢é˜…å’Œæ‰“å° - [pkg/cmd/tracee.go:107](pkg/cmd/tracee.go#L107)

```go
func (r Runner) runWithPrinter(ctx context.Context, t *tracee.Tracee) error {
    // è®¢é˜…æ‰€æœ‰äº‹ä»¶æµ
    stream := t.SubscribeAll()
    defer t.Unsubscribe(stream)

    // æ‰“å°åºè¨€ï¼ˆè¡¨å¤´ç­‰ï¼‰
    r.Printer.Preamble()

    // å¯åŠ¨æ‰“å° goroutine
    go func() {
        for {
            select {
            case event := <-stream.ReceiveEvents():
                r.Printer.Print(event)  // æ ¼å¼åŒ–æ‰“å°äº‹ä»¶
            case <-ctx.Done():
                return
            }
        }
    }()

    // é˜»å¡è¿è¡Œï¼Œç›´åˆ° ctx å–æ¶ˆ
    err := t.Run(ctx)

    // æ’ç©ºå‰©ä½™çš„ channel äº‹ä»¶ï¼ˆå…³é—­æœŸé—´å‘é€çš„ï¼‰
    for event := range stream.ReceiveEvents() {
        r.Printer.Print(event)
    }

    // æ‰“å°ç»Ÿè®¡ä¿¡æ¯
    stats := t.Stats()
    r.Printer.Epilogue(*stats)
    r.Printer.Close()

    return err
}
```

---

## 5. Tracee æ ¸å¿ƒç»“æ„ä½“

### 5.1 Tracee ç»“æ„ä½“å®šä¹‰ - [pkg/ebpf/tracee.go:60](pkg/ebpf/tracee.go#L60)

```go
type Tracee struct {
    // ========== é…ç½®ä¸çŠ¶æ€ ==========
    config    config.Config      // å…¨å±€é…ç½®
    bootTime  uint64             // ç³»ç»Ÿå¯åŠ¨æ—¶é—´ï¼ˆçº³ç§’ï¼‰
    startTime uint64             // Tracee å¯åŠ¨æ—¶é—´ï¼ˆçº³ç§’ï¼‰
    running   atomic.Bool        // åŸå­è¿è¡ŒçŠ¶æ€æ ‡å¿—
    done      chan struct{}      // å®‰å…¨åœæ­¢ä¿¡å·é€šé“
    OutDir    *os.File           // è¾“å‡ºç›®å½•æ–‡ä»¶æè¿°ç¬¦
    stats     *metrics.Stats     // ç»Ÿè®¡æŒ‡æ ‡

    // ========== äº‹ä»¶å¤„ç† ==========
    eventsSorter     *sorting.EventsChronologicalSorter  // æ—¶åºæ’åºå™¨
    eventsPool       *sync.Pool                          // äº‹ä»¶å¯¹è±¡æ± ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
    eventDecodeTypes map[events.ID][]data.DecodeAs       // äº‹ä»¶è§£ç ç±»å‹æ˜ å°„
    eventProcessor   map[events.ID][]func(*trace.Event)error  // äº‹ä»¶å¤„ç†å™¨
    eventDerivations derive.Table                        // æ´¾ç”Ÿäº‹ä»¶è¡¨

    // ========== eBPF æ ¸å¿ƒç»„ä»¶ ==========
    bpfModule       *bpf.Module         // libbpfgo BPF æ¨¡å—
    defaultProbes   *probes.ProbeGroup  // é»˜è®¤æ¢é’ˆç»„
    extraProbes     map[string]*probes.ProbeGroup  // é¢å¤–æ¢é’ˆ
    dataTypeDecoder bufferdecoder.TypeDecoder      // æ•°æ®ç±»å‹è§£ç å™¨

    // ========== BPF Maps ==========
    StackAddressesMap *bpf.BPFMap  // æ ˆåœ°å€ map
    FDArgPathMap      *bpf.BPFMap  // æ–‡ä»¶æè¿°ç¬¦è·¯å¾„ map

    // ========== Perf Buffersï¼ˆå†…æ ¸â†’ç”¨æˆ·ç©ºé—´æ•°æ®é€šé“ï¼‰==========
    eventsPerfMap  *bpf.PerfBuffer     // äº‹ä»¶ perf buffer
    fileWrPerfMap  *bpf.PerfBuffer     // æ–‡ä»¶å†™å…¥æ•è·
    netCapPerfMap  *bpf.PerfBuffer     // ç½‘ç»œæ•è·
    bpfLogsPerfMap *bpf.PerfBuffer     // eBPF æ—¥å¿—

    // ========== äº‹ä»¶é€šé“ ==========
    eventsChannel       chan []byte     // äº‹ä»¶åŸå§‹å­—èŠ‚æµ
    fileCapturesChannel chan []byte     // æ–‡ä»¶æ•è·æµ
    netCapChannel       chan []byte     // ç½‘ç»œæ•è·æµ
    bpfLogsChannel      chan []byte     // BPF æ—¥å¿—æµ

    // ========== ä¸¢å¤±äº‹ä»¶é€šé“ ==========
    lostEvChannel       chan uint64     // ä¸¢å¤±çš„äº‹ä»¶è®¡æ•°
    lostCapturesChannel chan uint64     // ä¸¢å¤±çš„æ–‡ä»¶æ•è·è®¡æ•°
    lostNetCapChannel   chan uint64     // ä¸¢å¤±çš„ç½‘ç»œæ•è·è®¡æ•°
    lostBPFLogChannel   chan uint64     // ä¸¢å¤±çš„ BPF æ—¥å¿—è®¡æ•°

    // ========== å­ç³»ç»Ÿ ==========
    cgroups           *cgroup.Cgroups              // Cgroup ç®¡ç†
    containers        *containers.Manager          // å®¹å™¨ç®¡ç†å™¨
    contPathResolver  *containers.ContainerPathResolver  // å®¹å™¨è·¯å¾„è§£æ
    contSymbolsLoader *containers.ContainersSymbolsLoader  // å®¹å™¨ç¬¦å·åŠ è½½
    controlPlane      *controlplane.Controller     // æ§åˆ¶å¹³é¢
    processTree       *proctree.ProcessTree        // è¿›ç¨‹æ ‘è¿½è¸ª
    dnsCache          *dnscache.DNSCache           // DNS ç¼“å­˜

    // ========== å·¥ä»¶ç®¡ç† ==========
    fileHashes     *digest.Cache        // æ–‡ä»¶å“ˆå¸Œç¼“å­˜
    capturedFiles  map[string]int64     // å·²æ•è·æ–‡ä»¶
    writtenFiles   map[string]string    // å·²å†™å…¥æ–‡ä»¶
    netCapturePcap *pcaps.Pcaps         // ç½‘ç»œ PCAP æ•è·
    readFiles      map[string]string    // å·²è¯»å–æ–‡ä»¶
    pidsInMntns    bucketcache.BucketCache  // æ¯ä¸ª mount namespace çš„å‰ n ä¸ª PID

    // ========== ç­–ç•¥ä¸æ£€æµ‹ ==========
    sigEngine         *engine.Engine      // ç­¾åæ£€æµ‹å¼•æ“
    policyManager     *policy.Manager     // ç­–ç•¥ç®¡ç†å™¨
    eventsDependencies *dependencies.Manager  // äº‹ä»¶ä¾èµ–ç®¡ç†å™¨

    // ========== å…¶ä»– ==========
    triggerContexts trigger.Context                    // è§¦å‘å™¨ä¸Šä¸‹æ–‡
    readyCallback   func(gocontext.Context)            // å°±ç»ªå›è°ƒ
    streamsManager  *streams.StreamsManager            // æµç®¡ç†å™¨
    kernelSymbols   atomic.Pointer[symbols.KernelSymbolTable]  // å†…æ ¸ç¬¦å·è¡¨
    requiredKsyms   []string                           // å¿…éœ€çš„å†…æ ¸ç¬¦å·
    extensions      *Extensions                        // æ‰©å±•ç®¡ç†å™¨
}
```

### 5.2 æ ¸å¿ƒè®¾è®¡äº®ç‚¹

#### ğŸ¯ **å¹¶å‘å®‰å…¨è®¾è®¡**

```go
running   atomic.Bool                              // åŸå­å¸ƒå°”å€¼ï¼Œæ— é”å¹¶å‘
kernelSymbols atomic.Pointer[symbols.KernelSymbolTable]  // åŸå­æŒ‡é’ˆ
```

**ä¼˜åŠ¿**ï¼šé¿å…é”ç«äº‰ï¼Œæé«˜æ€§èƒ½

#### ğŸ”„ **å¯¹è±¡æ± æ¨¡å¼**

```go
eventsPool *sync.Pool  // äº‹ä»¶å¯¹è±¡æ± 
```

**åŸç†**ï¼š
```go
// è·å–äº‹ä»¶å¯¹è±¡
evt := t.eventsPool.Get().(*trace.Event)

// ä½¿ç”¨å®Œæ¯•åæ”¾å›æ± ä¸­
t.eventsPool.Put(evt)
```

**ä¼˜åŠ¿**ï¼šå‡å°‘é¢‘ç¹çš„å†…å­˜åˆ†é…å’Œ GC å‹åŠ›

#### ğŸ“Š **å¤šé€šé“æ¶æ„**

```go
eventsChannel       chan []byte  // æ™®é€šäº‹ä»¶
fileCapturesChannel chan []byte  // æ–‡ä»¶æ•è·
netCapChannel       chan []byte  // ç½‘ç»œæ•è·
bpfLogsChannel      chan []byte  // eBPF æ—¥å¿—
```

**ä¼˜åŠ¿**ï¼šä¸åŒç±»å‹æ•°æ®åˆ†ç¦»å¤„ç†ï¼Œé¿å…é˜»å¡

#### ğŸ§© **æ¨¡å—åŒ–å­ç³»ç»Ÿ**

```go
containers   *containers.Manager     // å®¹å™¨ç®¡ç†
processTree  *proctree.ProcessTree   // è¿›ç¨‹æ ‘
dnsCache     *dnscache.DNSCache      // DNS ç¼“å­˜
```

**ä¼˜åŠ¿**ï¼šé«˜å†…èšä½è€¦åˆï¼Œä¾¿äºæµ‹è¯•å’Œç»´æŠ¤

### 5.3 å…³é”®æ–¹æ³•

```go
// åˆ›å»ºæ–°å®ä¾‹
func New(cfg config.Config) (*Tracee, error)

// åˆå§‹åŒ–ï¼ˆåŠ è½½ eBPF ç¨‹åºï¼‰
func (t *Tracee) Init(ctx context.Context) error

// è¿è¡Œä¸»å¾ªç¯
func (t *Tracee) Run(ctx context.Context) error

// è®¢é˜…äº‹ä»¶æµ
func (t *Tracee) SubscribeAll() *streams.Stream

// è·å–ç»Ÿè®¡ä¿¡æ¯
func (t *Tracee) Stats() *metrics.Stats

// è·å–ç­¾åå¼•æ“
func (t *Tracee) Engine() *engine.Engine
```

---

## 6. å®è·µç»ƒä¹ 

### ç»ƒä¹  1ï¼šç¼–è¯‘å’Œè¿è¡Œ Tracee

```bash
# 1. æ£€æŸ¥ç¯å¢ƒ
cd /home/work/tracee
make env

# 2. ç¼–è¯‘æ‰€æœ‰ç»„ä»¶
make all

# 3. æŸ¥çœ‹å¸®åŠ©
sudo ./dist/tracee --help

# 4. è¿è¡ŒåŸºæœ¬ç›‘æ§ï¼ˆè·Ÿè¸ªæ‰€æœ‰äº‹ä»¶ï¼‰
sudo ./dist/tracee

# 5. ä»…è·Ÿè¸ªç‰¹å®šäº‹ä»¶
sudo ./dist/tracee -e execve,openat

# 6. æŒ‰å®¹å™¨è¿‡æ»¤
sudo ./dist/tracee --scope container=new -e execve
```

### ç»ƒä¹  2ï¼šç†è§£å¯åŠ¨æµç¨‹

**ä»»åŠ¡**ï¼šåœ¨å…³é”®ä½ç½®æ·»åŠ æ—¥å¿—ï¼Œè§‚å¯Ÿå¯åŠ¨é¡ºåº

```bash
# åœ¨ä»¥ä¸‹æ–‡ä»¶æ·»åŠ  logger.Debugw() è¯­å¥ï¼š
# 1. cmd/tracee/cmd/root.go:52 - Run å‡½æ•°å¼€å§‹
# 2. pkg/cmd/tracee.go:30 - tracee.New() è°ƒç”¨å‰å
# 3. pkg/cmd/tracee.go:61 - t.Init() è°ƒç”¨å‰å
# 4. pkg/cmd/tracee.go:98 - t.Run() è°ƒç”¨å‰

# é‡æ–°ç¼–è¯‘å¹¶è¿è¡Œ
make tracee
sudo ./dist/tracee -l debug -e execve
```

### ç»ƒä¹  3ï¼šåˆ†æ Tracee ç»“æ„ä½“

**ä»»åŠ¡**ï¼šç¼–å†™ä¸€ä¸ªå°å·¥å…·æ‰“å° Tracee å®ä¾‹çš„å†…å­˜å ç”¨

```go
// åœ¨ pkg/ebpf/tracee.go æ·»åŠ æ–¹æ³•
func (t *Tracee) PrintMemoryStats() {
    fmt.Printf("Tracee Instance Memory Layout:\n")
    fmt.Printf("  eventsChannel cap: %d\n", cap(t.eventsChannel))
    fmt.Printf("  fileCapturesChannel cap: %d\n", cap(t.fileCapturesChannel))
    fmt.Printf("  capturedFiles count: %d\n", len(t.capturedFiles))
    // ... æ·»åŠ æ›´å¤šå­—æ®µ
}
```

### ç»ƒä¹  4ï¼šè·Ÿè¸ªä¸€ä¸ªç³»ç»Ÿè°ƒç”¨

**ä»»åŠ¡**ï¼šæ‰§è¡Œå‘½ä»¤å¹¶è§‚å¯Ÿ `execve` äº‹ä»¶

```bash
# ç»ˆç«¯1ï¼šè¿è¡Œ Tracee
sudo ./dist/tracee -e execve -o json

# ç»ˆç«¯2ï¼šæ‰§è¡Œå‘½ä»¤è§¦å‘äº‹ä»¶
ls /tmp
whoami
ps aux | grep tracee

# è§‚å¯Ÿè¾“å‡ºçš„ JSON äº‹ä»¶ï¼Œç†è§£äº‹ä»¶ç»“æ„
```

### ç»ƒä¹  5ï¼šä½¿ç”¨ç­–ç•¥æ–‡ä»¶

**ä»»åŠ¡**ï¼šåˆ›å»ºç­–ç•¥æ–‡ä»¶ï¼Œä»…ç›‘æ§ç‰¹å®šæ–‡ä»¶è®¿é—®

åˆ›å»ºæ–‡ä»¶ `test-policy.yaml`ï¼š

```yaml
apiVersion: tracee.aquasecurity.github.io/v1beta1
kind: Policy
metadata:
  name: monitor-passwd-access
spec:
  scope:
    - global
  rules:
    - event: security_file_open
      filters:
        - args.pathname: "/etc/passwd"
```

è¿è¡Œï¼š

```bash
sudo ./dist/tracee --policy test-policy.yaml

# åœ¨å¦ä¸€ç»ˆç«¯è§¦å‘
cat /etc/passwd
cat /etc/shadow  # ä¸ä¼šè§¦å‘äº‹ä»¶
```

---

## 7. ä¸‹ä¸€æ­¥å­¦ä¹ 

å®Œæˆç¬¬ä¸€é˜¶æ®µåï¼Œä½ åº”è¯¥æŒæ¡ï¼š

- âœ… Tracee çš„æ•´ä½“æ¶æ„å’Œåˆ†å±‚è®¾è®¡
- âœ… æ ¸å¿ƒå¯åŠ¨æµç¨‹å’Œç»„ä»¶åˆå§‹åŒ–é¡ºåº
- âœ… Tracee ç»“æ„ä½“çš„å­—æ®µå’ŒèŒè´£åˆ’åˆ†
- âœ… åŸºæœ¬çš„å‘½ä»¤è¡Œä½¿ç”¨å’Œé…ç½®

### æ¨èé˜…è¯»è·¯å¾„

1. **æ·±å…¥ç†è§£äº‹ä»¶ç³»ç»Ÿ** â†’ [ç¬¬äºŒé˜¶æ®µï¼šäº‹ä»¶å¤„ç†æµæ°´çº¿](02-event-pipeline.md)
2. **eBPF å†…æ ¸ä¾§å®ç°** â†’ [ç¬¬ä¸‰é˜¶æ®µï¼šeBPF å®ç°](03-ebpf-implementation.md)
3. **ç”¨æˆ·ç©ºé—´å¤„ç†** â†’ [ç¬¬å››é˜¶æ®µï¼šGo å®ç°](04-userspace-implementation.md)

### å…³é”®æºæ–‡ä»¶æ¸…å•

| ä¼˜å…ˆçº§ | æ–‡ä»¶ | å»ºè®®é˜…è¯»é¡ºåº |
|--------|------|-------------|
| ğŸ”¥ğŸ”¥ğŸ”¥ | `cmd/tracee/main.go` | 1 |
| ğŸ”¥ğŸ”¥ğŸ”¥ | `cmd/tracee/cmd/root.go` | 2 |
| ğŸ”¥ğŸ”¥ğŸ”¥ | `pkg/cmd/tracee.go` | 3 |
| ğŸ”¥ğŸ”¥ğŸ”¥ | `pkg/ebpf/tracee.go` | 4 |
| ğŸ”¥ğŸ”¥ | `pkg/ebpf/events_pipeline.go` | 5 |
| ğŸ”¥ğŸ”¥ | `pkg/events/core.go` | 6 |
| ğŸ”¥ | `pkg/policy/policy_manager.go` | 7 |

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Tracee å®˜æ–¹æ–‡æ¡£](https://aquasecurity.github.io/tracee/)
- [eBPF å®˜æ–¹æ–‡æ¡£](https://ebpf.io/)
- [libbpfgo GitHub](https://github.com/aquasecurity/libbpfgo)
- [Tracee æ¶æ„è®¨è®º](https://github.com/aquasecurity/tracee/discussions/2499)

---

**ä¸‹ä¸€ç¯‡**ï¼š[ç¬¬äºŒé˜¶æ®µï¼šäº‹ä»¶å¤„ç†æµæ°´çº¿æ·±åº¦è§£æ](02-event-pipeline.md)
